<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multi-Project Meeting Tracker</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>

        .editable-area { min-height: 250px; border: 1px solid #e5e7eb; padding: 15px; border-radius: 8px; background: white; }

        .editable-area:focus { outline: 2px solid #3b82f6; border-color: transparent; }

        .editable-area img { max-width: 100%; height: auto; margin: 10px 0; border-radius: 4px; display: block; }

        ::-webkit-scrollbar { width: 6px; }

        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
</style>
</head>
<body class="bg-gray-50 flex h-screen overflow-hidden text-gray-800 font-sans">
<aside class="w-72 bg-slate-900 text-slate-300 flex flex-col shadow-2xl">
<div class="p-6 overflow-y-auto h-full flex flex-col">
<h2 class="text-white text-lg font-bold mb-4">Projects</h2>
<div class="mb-6 space-y-2">
<div class="flex space-x-2">
<select id="projectSelect" onchange="switchProject(this.value)" class="flex-1 bg-slate-800 text-white p-2 rounded-lg outline-none border border-slate-700 focus:border-blue-500 text-sm"></select>
<button onclick="deleteCurrentProject()" title="Delete Project" class="bg-slate-800 hover:bg-red-900 text-slate-400 hover:text-white p-2 rounded-lg transition border border-slate-700">üóë</button>
</div>
<button onclick="addProject()" class="w-full text-xs text-blue-400 hover:text-blue-300 text-left px-1 font-medium">+ Add New Project</button>
</div>
<hr class="border-slate-800 mb-6">
<h2 class="text-white text-sm font-bold mb-4 uppercase tracking-widest">Meeting Archive</h2>
<button onclick="createNewDay()" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-3 rounded-xl font-bold transition shadow-lg mb-6">+ New Meeting Page</button>
<div id="historyNav" class="space-y-4 flex-1"></div>
</div>
</aside>
<main class="flex-1 flex flex-col overflow-hidden">
<header class="bg-white border-b px-8 py-4 flex justify-between items-center shadow-sm">
<div class="flex items-center space-x-4">
<input type="date" id="datePicker" onchange="changeDate(this.value)" class="text-xl font-bold text-gray-700 bg-gray-100 p-2 rounded-lg outline-none border border-transparent focus:border-blue-500">
<span id="activeProjectLabel" class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-bold tracking-tight"></span>
</div>
<div class="space-x-2">
<button onclick="saveCurrentData()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-2 rounded-lg text-sm transition shadow-sm">Save Changes</button>
<button onclick="exportToMailHTML()" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-lg text-sm transition font-medium shadow-sm">Export to Email</button>
</div>
</header>
<div class="flex-1 overflow-y-auto p-8">
<div class="max-w-4xl mx-auto space-y-8">
<section>
<h2 class="text-sm font-bold text-blue-500 uppercase tracking-widest mb-3 italic">1. Agenda & Notes</h2>
<div id="agendaContent" contenteditable="true" class="editable-area shadow-inner" placeholder="Enter agenda or paste screenshots here..."></div>
</section>
<section>
<h2 class="text-sm font-bold text-orange-500 uppercase tracking-widest mb-3 italic">2. Action Items (Full Tracker)</h2>
<div class="bg-white shadow rounded-lg overflow-hidden border">
<table class="w-full text-left" id="mainActionTable">
<thead class="bg-gray-50 border-b">
<tr>
<th class="p-3 text-xs font-semibold text-gray-500">Task</th>
<th class="p-3 text-xs font-semibold text-gray-500 w-40">Due Date</th>
<th class="p-3 text-xs font-semibold text-gray-500 w-32">Owner</th>
<th class="p-3 text-xs font-semibold text-gray-500 w-28">Status</th>
<th class="p-3 text-xs font-semibold text-gray-500 w-12 text-center"></th>
</tr>
</thead>
<tbody id="actionTableBody"></tbody>
</table>
<div class="p-3 bg-gray-50 border-t">
<button onclick="addRow()" class="text-sm text-blue-600 hover:text-blue-800 font-medium">+ Add New Item</button>
</div>
</div>
</section>
</div>
</div>
</main>
<script>

        let currentProject = "";

        let currentKey = ""; 

        window.onload = () => {

            initProjects();

            const today = new Date().toISOString().split('T')[0];

            loadDay(today);

        };

        function initProjects() {

            let projects = JSON.parse(localStorage.getItem('meeting_projects')) || ["Default Project"];

            currentProject = localStorage.getItem('last_project') || projects[0];

            if (!projects.includes(currentProject)) currentProject = projects[0];

            localStorage.setItem('meeting_projects', JSON.stringify(projects));

            renderProjectSelect(projects);

        }

        function renderProjectSelect(projects) {

            const select = document.getElementById('projectSelect');

            select.innerHTML = projects.map(p => `<option value="${p}" ${p === currentProject ? 'selected' : ''}>${p}</option>`).join('');

            document.getElementById('activeProjectLabel').innerText = currentProject;

        }

        function addProject() {

            const name = prompt("Enter new project name:");

            if (name && name.trim()) {

                let projects = JSON.parse(localStorage.getItem('meeting_projects'));

                if (!projects.includes(name)) {

                    projects.push(name);

                    localStorage.setItem('meeting_projects', JSON.stringify(projects));

                    switchProject(name);

                }

            }

        }

        function deleteCurrentProject() {

            let projects = JSON.parse(localStorage.getItem('meeting_projects'));

            if (projects.length <= 1) return alert("Cannot delete the last project.");

            if (confirm(`Delete entire project "${currentProject}" and all its records?`)) {

                const prefix = `${currentProject}_`;

                Object.keys(localStorage).forEach(key => { if (key.startsWith(prefix)) localStorage.removeItem(key); });

                projects = projects.filter(p => p !== currentProject);

                localStorage.setItem('meeting_projects', JSON.stringify(projects));

                switchProject(projects[0]);

            }

        }

        function switchProject(name) {

            currentProject = name;

            localStorage.setItem('last_project', name);

            renderProjectSelect(JSON.parse(localStorage.getItem('meeting_projects')));

            loadDay(new Date().toISOString().split('T')[0]);

        }

        function loadDay(dateStr) {

            currentKey = dateStr;

            document.getElementById('datePicker').value = dateStr;

            const storageKey = `${currentProject}_${dateStr}`;

            const savedData = JSON.parse(localStorage.getItem(storageKey)) || { agenda: "", actions: [] };

            document.getElementById('agendaContent').innerHTML = savedData.agenda;

            const tbody = document.getElementById('actionTableBody');

            tbody.innerHTML = "";

            let displayActions = savedData.actions;

            if (displayActions.length === 0) displayActions = getProjectAllActions(); 

            displayActions.forEach(item => addRow(item.content, item.date, item.owner, item.status));

            if (displayActions.length === 0) addRow();

            renderHistoryNav();

        }

        function getProjectAllActions() {

            let allItems = [];

            const prefix = `${currentProject}_`;

            Object.keys(localStorage).sort().forEach(key => {

                if (key.startsWith(prefix)) {

                    const data = JSON.parse(localStorage.getItem(key));

                    if (data.actions) allItems.push(...data.actions);

                }

            });

            return Array.from(new Map(allItems.map(item => [item.content, item])).values());

        }

        function addRow(content = '', date = '', owner = '', status = 'Pending') {

            const tbody = document.getElementById('actionTableBody');

            const tr = document.createElement('tr');

            tr.className = "border-b last:border-0 hover:bg-gray-50 transition group text-sm";

            tr.innerHTML = `
<td class="p-2"><input type="text" value="${content}" class="w-full bg-transparent outline-none px-2 py-1"></td>
<td class="p-2"><input type="date" value="${date}" class="w-full bg-transparent outline-none px-2 py-1"></td>
<td class="p-2"><input type="text" value="${owner}" class="w-full bg-transparent outline-none px-2 py-1"></td>
<td class="p-2">
<select onchange="saveCurrentData(); updateStatusColor(this)" class="w-full bg-transparent outline-none font-medium ${status === 'Done' ? 'text-green-600' : 'text-orange-600'}">
<option value="Pending" ${status === 'Pending' ? 'selected' : ''}>Pending</option>
<option value="Done" ${status === 'Done' ? 'selected' : ''}>Done</option>
</select>
</td>
<td class="p-2 text-center">
<button onclick="this.closest('tr').remove(); saveCurrentData();" class="text-gray-300 hover:text-red-500 transition opacity-0 group-hover:opacity-100">‚úï</button>
</td>

            `;

            tbody.appendChild(tr);

        }

        function updateStatusColor(select) {

            select.className = `w-full bg-transparent outline-none font-medium ${select.value === 'Done' ? 'text-green-600' : 'text-orange-600'}`;

        }

        function saveCurrentData() {

            const agenda = document.getElementById('agendaContent').innerHTML;

            const actionRows = Array.from(document.querySelectorAll('#actionTableBody tr'));

            const actions = actionRows.map(row => {

                const inputs = row.querySelectorAll('input, select');

                return { content: inputs[0].value, date: inputs[1].value, owner: inputs[2].value, status: inputs[3].value };

            }).filter(item => item.content.trim() !== "");

            localStorage.setItem(`${currentProject}_${currentKey}`, JSON.stringify({ agenda, actions }));

            renderHistoryNav();

        }

        function renderHistoryNav() {

            const nav = document.getElementById('historyNav');

            nav.innerHTML = "";

            const prefix = `${currentProject}_`;

            const keys = Object.keys(localStorage).filter(k => k.startsWith(prefix)).map(k => k.replace(prefix, '')).sort().reverse();

            const structure = {};

            keys.forEach(k => {

                const [y, m, d] = k.split('-');

                if (!structure[y]) structure[y] = {};

                if (!structure[y][m]) structure[y][m] = [];

                structure[y][m].push(k);

            });

            for (const y in structure) {

                let yHtml = `<details open class="group"><summary class="cursor-pointer font-bold text-slate-400 group-hover:text-white transition">${y}</summary><div class="ml-4 mt-2 space-y-2">`;

                for (const m in structure[y]) {

                    yHtml += `<details open><summary class="cursor-pointer text-sm font-semibold text-slate-500">Month ${m}</summary><div class="ml-2 border-l border-slate-700 my-1 font-light text-xs">`;

                    structure[y][m].forEach(date => {

                        yHtml += `<div onclick="loadDay('${date}')" class="group/item flex justify-between items-center pl-3 pr-2 py-1 hover:bg-slate-800 cursor-pointer rounded ${date === currentKey ? 'text-blue-400 font-bold bg-slate-800' : ''}">
<span>${date}</span>
<button onclick="deleteMeeting('${date}', event)" class="opacity-0 group-hover/item:opacity-100 text-slate-500 hover:text-red-500 transition">üóë</button>
</div>`;

                    });

                    yHtml += `</div></details>`;

                }

                yHtml += `</div></details>`;

                nav.innerHTML += yHtml;

            }

        }

        async function exportToMailHTML() {

            const agendaHTML = document.getElementById('agendaContent').innerHTML;

            const actionRows = Array.from(document.querySelectorAll('#actionTableBody tr'));

            let actionTableHTML = `
<table style="width:100%; border-collapse:collapse; margin-top:20px; font-family: sans-serif; font-size: 14px;">
<tr style="background-color:#f8f9fa;">
<th style="border:1px solid #ddd; padding:10px; text-align:left;">Status</th>
<th style="border:1px solid #ddd; padding:10px; text-align:left;">Task Description</th>
<th style="border:1px solid #ddd; padding:10px; text-align:left;">Due</th>
<th style="border:1px solid #ddd; padding:10px; text-align:left;">Owner</th>
</tr>`;

            actionRows.forEach(row => {

                const inputs = row.querySelectorAll('input, select');

                if(inputs[0].value) {

                    const isDone = inputs[3].value === 'Done';

                    const statusText = isDone ? '<b style="color:green;">[Done]</b>' : '<b style="color:orange;">[Pending]</b>';

                    const textStyle = isDone ? 'text-decoration: line-through; color: #888;' : '';

                    actionTableHTML += `
<tr>
<td style="border:1px solid #ddd; padding:8px; text-align:center;">${statusText}</td>
<td style="border:1px solid #ddd; padding:8px; ${textStyle}">${inputs[0].value}</td>
<td style="border:1px solid #ddd; padding:8px; ${textStyle}">${inputs[1].value}</td>
<td style="border:1px solid #ddd; padding:8px; ${textStyle}">${inputs[2].value}</td>
</tr>`;

                }

            });

            actionTableHTML += `</table>`;

            // Agenda ÂçÄÂ°äÁèæÂú®Áõ¥Êé•Ë≤º‰∏äÂéüÂßã HTMLÔºå‰∏çÈ°çÂ§ñÂä†Êï∏Â≠óÊ®ôÁ±§

            const fullContentHTML = `
<div style="font-family: sans-serif; color: #333; line-height: 1.6;">
<h2 style="color: #2563eb; margin-bottom: 5px;">Meeting Minutes: ${currentProject}</h2>
<p style="color: #666; margin-top: 0;">Date: ${currentKey}</p>
<h3 style="border-bottom: 2px solid #2563eb; padding-bottom: 5px; color: #2563eb;">Agenda & Notes</h3>
<div style="background: #fff; padding: 10px;">${agendaHTML}</div>
<h3 style="border-bottom: 2px solid #ea580c; padding-bottom: 5px; margin-top: 30px; color: #ea580c;">Action Items Tracker</h3>

                    ${actionTableHTML}
</div>

            `;

            try {

                const blob = new Blob([fullContentHTML], { type: 'text/html' });

                const data = [new ClipboardItem({ 

                    'text/html': blob, 

                    'text/plain': new Blob([document.getElementById('agendaContent').innerText], { type: 'text/plain' }) 

                })];

                await navigator.clipboard.write(data);

                alert('Copied! Agenda content and full Action Items are ready to paste.');

            } catch (err) {

                alert('Export failed.');

            }

        }

        function createNewDay() {

            const date = prompt("Enter meeting date (YYYY-MM-DD):", new Date().toISOString().split('T')[0]);

            if (date) loadDay(date);

        }

        function deleteMeeting(date, event) {

            event.stopPropagation();

            if(confirm(`Delete record for ${date}?`)) { localStorage.removeItem(`${currentProject}_${date}`); renderHistoryNav(); }

        }

        function changeDate(d) { loadDay(d); }
</script>
</body>
</html>
 
